{% extends "themes/NeoLearn/base.html" %}

{% load static %}

{% block title %}Dashboard - {{ school.name }}{% endblock %}

{% block body_class %}dashboard-page{% endblock %}

{% block content %}

<!-- ======= Page Hearder ======= -->
<div class="page-header">
    {% include "themes/NeoLearn/components/page_header.html" with title="Dashboard" subtitle="Bem-vindo de volta, "|add:user.get_full_name %}
</div>

<!-- ======= Analytics Cards ======= -->
<div class="analytics-grid">
    {% include "themes/NeoLearn/components/analytics-card.html" with icon="üéì" value=courses_total label="Total de Cursos" %}
    {% include "themes/NeoLearn/components/analytics-card.html" with icon="üìö" value=lessons_total label="Aulas totais" %}
    {% include "themes/NeoLearn/components/analytics-card.html" with icon="‚è±Ô∏è" value=school_duration.formatted label="Horas de Conte√∫do" %}
    {% include "themes/NeoLearn/components/analytics-card.html" with icon="üìà" value=school_progress_avg|stringformat:"s%%" label="Taxa de Conclus√£o" %}
</div>

<!-- ======= Dashboard Grid ======= -->
<div class="dashboard-grid">
    <div class="dashboard-section">
        <div class="section-header">
            <h2 class="section-title">Cursos Recentes</h2>
            <a href="{% url 'course_catalog' slug=school_user.school.slug %}" class="section-link">Ver todos</a>
        </div>
        
        <div class="courses-list">

            {% for course in recent_courses %}
                {% if course in featured %}
                <div class="course-card">
                    <div class="course-thumbnail">
                        {% load custom_filters %}

                        {% if course.video_intro %}

                        {% if 'youtube.com' in course.video_intro or 'youtu.be' in course.video_intro %}
                        <iframe 
                            width="100%" 
                            height="100%" 
                            src="{{ course.video_intro|youtube_embed }}" 
                            title="YouTube video player" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                            referrerpolicy="strict-origin-when-cross-origin" 
                            allowfullscreen>
                        </iframe>
                        
                        {% else %}
                            <video src="{{ course.video_intro.url }}" controls width="100%"></video>
                        {% endif %}
                        {% elif course.thumbnail %}
                            <img src="{{ course.thumbnail.url }}" alt="{{ course.title }}">
                        {% else %}
                            <img src="{% static 'img/placeholder-course.jpg' %}" alt="{{ course.title }}">
                        {% endif %}
                        {% if course.created_at|date:"Y-m" == now|date:"Y-m" %}
                            <span class="course-list-badge">Novo</span>
                        {% endif %}
                    </div>
                    <div class="course-info">
                        <h3>{{ course.title }}</h3>

                        <p class="course-instructor">
                            üë®‚Äçüè´ Prof. {{ course.instructor.get_full_name|default:course.instructor.username }}
                        </p>


                        <div class="course-meta">
                            <span class="course-lessons">
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                    <path d="M7 1L1 4l6 3 6-3-6-3zM1 10l6 3 6-3" stroke="currentColor" stroke-width="1.5"/>
                                </svg>
                                 {{ course.subjects.count }} Mat√©rias
                            </span>

                            <span class="course-lessons">
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                    <path d="M7 1L1 4l6 3 6-3-6-3zM1 10l6 3 6-3" stroke="currentColor" stroke-width="1.5"/>
                                </svg>
                                 {{ course.num_lessons }} aulas

                            </span>

                        </div>
                        <a href="{% url 'course_detail' slug=school.slug course_id=course.id %}" class="btn btn-outline" style="margin-top:8px;">
                            Ver curso ‚Üí
                        </a>
                    </div>
                </div>
                {% endif %}
            {% empty %}
                <p>Nenhum curso recente encontrado.</p>
            {% endfor %} 

        </div>
    </div>
    
    <div class="dashboard-aside">
        <div class="widget">
            <div class="widget-header">
                <h3 class="widget-title">Atividade Recente</h3>
            </div>
            <div class="activity-list">
                {% if last_course %}
                <div class="activity-item">
                    <div class="activity-icon" style="background: #764ba2;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="activity-content">
                        <p><strong>Novo curso criado</strong><br> {{ last_course.title|title  }}</p>
                        <span class="activity-time">{{ last_course.created_at|timesince }}</span>
                    </div>
                </div>
                {% endif %}
                
                {% if last_lesson %}
                <div class="activity-item">
                    <div class="activity-icon" style="background:#667eea;">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M8 1L1 4l7 3 7-3-7-3zM1 12l7 3 7-3" stroke="white" stroke-width="1.5"/>
                        </svg>
                    </div>
                    <div class="activity-content">
                        <p><strong>Nova aula publicada</strong><br> {{ last_lesson.title|title }}</p>
                        <span class="activity-time">{{ last_lesson.created_at|timesince }}</span>
                    </div>
                </div>
                {% endif %}

                {% if last_student %}
                <div class="activity-item">
                    <div class="activity-icon" style="background:#27ae60;">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M13 14v-1a3 3 0 0 0-3-3H6a3 3 0 0 0-3 3v1M8 7a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" stroke="white" stroke-width="1.5"/>
                        </svg>
                    </div>
                    <div class="activity-content">
                        <p><strong>Novo aluno</strong><br> {{ last_student.user.get_full_name|default:last_student.user.username }}</p>
                        <span class="activity-time">{{ last_student.created_at|timesince }}</span>
                    </div>
                </div>
                {% endif %}

                {% if not last_lesson and not last_course and not last_student %}
                    <p>Nenhuma atividade recente nos √∫ltimos 7 dias.</p>
                {% endif %}
            </div>
        </div>
    
    </div>
</div>
{% endblock %}